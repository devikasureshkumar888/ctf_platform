# Mastodon Flag Planting Guide

This guide provides step-by-step instructions for planting CTF flags in the Mastodon instance. **Good news:** Both Mastodon challenges can be completed through the web interface - **no server access required!**

## Overview

- **Chapter:** 1 - Mastodon Social Network
- **Challenges:** 2
- **Total Points:** 300
- **Access Required:** User account on Mastodon (can be created via web registration)

## Prerequisites

Before planting flags, you need to generate them:

```bash
cd mastodon
./test-local.sh
```

This will show you the flags that need to be planted. Save these values!

---

## Challenge 1: The Hidden Toot

**Challenge ID:** `mastodon_hidden_toot`
**Points:** 100
**Flag Location:** HTML comment in user's toot/profile

### Flag Format
```
CYBERLABFLAG{a1b2c3d4e5f6g7h8}
```
(Your actual flag will be different - use the one generated by test-local.sh)

### Method 1: Post with HTML Comment (Recommended)

**Step 1: Create CTF User Account**

1. Navigate to: `https://mastodon.cyberlab.local`
2. Click "Create account" or "Sign up"
3. Register with:
   - **Username:** `ctf_user_2024`
   - **Display Name:** `CTF User`
   - **Email:** (use any valid email you have access to)
   - **Password:** (save this securely)
4. Verify email if required
5. Complete account setup

**Step 2: Create Profile Bio with Flag**

1. Log in as @ctf_user_2024
2. Go to "Edit Profile"
3. In the "Bio" field, add:
   ```
   Welcome to CyberLab Mastodon! ðŸš€
   I'm here for the CTF challenges.
   ```
4. If Mastodon allows HTML in bio, try adding:
   ```html
   Welcome to CyberLab Mastodon! ðŸš€
   <!-- CTF Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
   ```
5. Save profile

**Step 3: Create Public Toot**

1. Create a new public post (toot) with this content:
   ```
   Welcome to CyberLab Mastodon! ðŸš€

   Excited to be part of this community!
   #CyberLab #CTF
   ```

2. Pin this toot to your profile (click "..." â†’ "Pin to profile")

**Step 4: Add Flag to Profile Page (If Possible)**

Since Mastodon may sanitize HTML in toots, the flag might need to be in the page source itself. If you have any way to add custom HTML to your profile:

- Use profile customization features
- Add to bio with HTML enabled
- Or note it in "metadata fields" on profile

**Alternative Method:** If direct HTML injection doesn't work:

Add the flag to profile metadata fields:

1. Go to Edit Profile
2. In "Profile Metadata" section, add:
   - **Field Name:** `Website`
   - **Field Value:** `https://cyberlab.local/flag?id=CYBERLABFLAG{a1b2c3d4e5f6g7h8}`
3. Or encode it:
   - **Field Name:** `Secret`
   - **Field Value:** `Q1lCRVJMQUJGTEFHe2ExYjJjM2Q0ZTVmNmc3aDh9` (base64 encoded flag)

### Method 2: Request Admin to Add HTML Comment

If you can't inject HTML yourself:

1. Request Mastodon admin to add an HTML comment to the @ctf_user_2024 profile page template
2. Provide them with:
   ```html
   <!-- CTF Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
   ```
3. They can add it to the user's profile page template or a specific toot

### Verification

Test that participants can find the flag:

```bash
# View profile page source
curl https://mastodon.cyberlab.local/@ctf_user_2024 | grep "CTF Flag"

# Or visit in browser and View Page Source (Ctrl+U)
```

Participants should find the flag by:
1. Navigating to @ctf_user_2024's profile
2. Viewing page source (Right-click â†’ View Page Source)
3. Searching for "CTF Flag" or "CYBERLABFLAG"

---

## Challenge 2: Profile Picture Secrets

**Challenge ID:** `mastodon_profile_secrets`
**Points:** 200
**Flag Location:** EXIF metadata in profile picture

### Flag Format
```
CYBERLABFLAG{metadata_hunter_2024}
```
(Your actual flag will be different - use the one generated by test-local.sh)

### Method 1: Create Image with Embedded Flag (Recommended)

**Step 1: Create/Download a Base Image**

```bash
# Download a sample profile picture or create one
wget https://via.placeholder.com/400x400.jpg -O profile.jpg
# Or use any existing image
```

**Step 2: Embed Flag in EXIF Metadata**

Using `exiftool` (install if needed: `sudo apt install exiftool`):

```bash
# Embed flag in Comment field
exiftool -Comment="CYBERLABFLAG{metadata_hunter_2024}" profile.jpg

# Verify it worked
exiftool profile.jpg | grep Comment

# Alternative: Add to multiple fields for redundancy
exiftool -Comment="CYBERLABFLAG{metadata_hunter_2024}" \
         -Artist="CTF User 2024" \
         -Copyright="CyberLab CTF" \
         -Description="Profile picture for CTF challenge" \
         profile.jpg
```

Or using `jhead` (for JPEG files):

```bash
# Install jhead
sudo apt install jhead

# Add comment
jhead -cl "CYBERLABFLAG{metadata_hunter_2024}" profile.jpg

# Verify
jhead profile.jpg
```

**Step 3: Upload to Mastodon Profile**

1. Log in to Mastodon as @ctf_user_2024
2. Go to "Edit Profile"
3. Click on profile picture area
4. Upload the `profile.jpg` file with embedded flag
5. Save changes

**Step 4: Verify Upload Preserved Metadata**

```bash
# Download the uploaded profile picture from Mastodon
wget https://mastodon.cyberlab.local/system/accounts/avatars/.../profile.jpg -O downloaded.jpg

# Check if metadata is still there
exiftool downloaded.jpg | grep Comment
```

**Note:** Some platforms strip EXIF data for privacy. If Mastodon removes it, see alternative methods below.

### Method 2: Steganography (If EXIF is Stripped)

If Mastodon strips EXIF metadata, use steganography instead:

```bash
# Install steghide
sudo apt install steghide

# Create a text file with flag
echo "CYBERLABFLAG{metadata_hunter_2024}" > flag.txt

# Embed in image
steghide embed -cf profile.jpg -ef flag.txt -p "ctf2024"

# This creates profile.jpg with hidden flag
# Upload this to Mastodon profile
```

**Hint for participants:** "The password is 'ctf2024'"

### Method 3: Simple Text in Image

If technical methods fail, use image editing to add flag:

```bash
# Use ImageMagick to add text to image
convert profile.jpg -pointsize 12 -fill white -annotate +10+20 "Flag: CYBERLABFLAG{metadata_hunter_2024}" profile_with_flag.jpg
```

Or manually edit the image in GIMP/Photoshop to add tiny text with the flag.

### Alternative: Use Avatar Description

Some Mastodon instances allow alt-text for profile pictures:

1. Upload profile picture
2. In alt-text field, add: `Profile picture - CYBERLABFLAG{metadata_hunter_2024}`
3. Participants can inspect the image element to find alt text

### Verification

Test that the flag can be extracted:

```bash
# Download profile picture
wget https://mastodon.cyberlab.local/@ctf_user_2024/avatar.jpg -O test.jpg

# Extract EXIF data
exiftool test.jpg

# Or for steganography:
steghide extract -sf test.jpg -p "ctf2024"
```

---

## Web-Based Flag Planting Script

For automation, you can use the provided script:

```bash
cd mastodon
./plant-flags-web.sh
```

This script will:
1. Generate flags
2. Create image with embedded metadata
3. Provide instructions for uploading
4. (Optional) Attempt automated upload via Mastodon API if you have access token

---

## Summary Checklist

- [ ] Generate flags using `./mastodon/test-local.sh`
- [ ] Save generated flag values
- [ ] **Challenge 1: The Hidden Toot**
  - [ ] Create @ctf_user_2024 account on Mastodon
  - [ ] Add flag to profile bio or toot
  - [ ] Pin toot to profile
  - [ ] Verify flag visible in page source
- [ ] **Challenge 2: Profile Picture Secrets**
  - [ ] Create/download base image
  - [ ] Embed flag in EXIF metadata using exiftool
  - [ ] Upload to @ctf_user_2024 profile
  - [ ] Download and verify metadata preserved
  - [ ] If stripped, use steganography alternative
- [ ] Register challenges in CTFd: `./mastodon/register-challenges.sh`
- [ ] Test both challenges manually
- [ ] Document extraction method for participants (in hints)

---

## Communication Template

If you need help from Mastodon admin:

```
Subject: CTF User Account for CyberLab CTF

Hi Mastodon Team,

We're setting up CTF challenges using the Mastodon instance.

WHAT WE NEED:

1. Permission to create user account: @ctf_user_2024
   - Or you can create it and share credentials with us
   - We'll use it to post CTF content

2. Ability to upload a profile picture with metadata
   - Need EXIF metadata preserved if possible
   - Or guidance on what metadata is preserved

TIMELINE: Within 5 days if possible.

IMPACT: Minimal - just one user account with normal posts

Let us know if this is okay or if you have any concerns!

Thanks,
CyberLab CTF Team
```

---

## Troubleshooting

### Can't create account (registration closed)

- Ask Mastodon admin to create account for you
- Or ask them to enable open registration temporarily
- Provide them with username and they can share credentials

### HTML comments stripped from toots

- Use profile bio instead
- Or use metadata fields
- Or ask admin to add comment to profile page template

### EXIF metadata stripped from uploads

- Use steganography with `steghide` instead
- Or add visible text to image
- Or use alt-text field

### Profile picture not updating

- Clear browser cache
- Try different image format (PNG vs JPG)
- Check file size limits

---

## Next Steps

After planting flags:

1. Verify both flags are accessible
2. Create test participant account
3. Try to solve challenges yourself
4. Register in CTFd: `./mastodon/register-challenges.sh`
5. Test with fresh user account

For PR-based planting (if needed for custom features), see: [flag-planting-pr-template.md](flag-planting-pr-template.md)
