# Hospital Flag Planting Guide

This guide provides step-by-step instructions for planting CTF flags in the Hospital system when you don't have direct server access.

## Overview

- **Chapter:** 2 - Hospital Management System
- **Challenges:** 2
- **Total Points:** 350

## Prerequisites

Before planting flags, you need to generate them:

```bash
cd hospital
./test-local.sh
```

This will show you the flags that need to be planted. Save these values!

---

## Challenge 1: Public Patient Records

**Challenge ID:** `hospital_patient_records`
**Points:** 100
**Flag Location:** Database - patients table, patient ID 999

### Flag Format
```
CYBERLABFLAG{f6c7e8a9b1d2c3e4}
```
(Your actual flag will be different - use the one generated by test-local.sh)

### Method 1: Through Hospital Web Interface (If Available)

If the Hospital system has an admin panel for adding patients:

1. Log in to Hospital admin panel
2. Navigate to "Add Patient" or "Patients" section
3. Create new patient with these details:
   - **Patient ID:** 999
   - **Name:** CTF Test Patient
   - **Age:** 45
   - **Diagnosis:** Routine Checkup
   - **Medical Notes:** `Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{your_flag_here}`
4. Save the patient record
5. Verify it's accessible at: `https://hospital.cyberlab.local/patients/999` or `/api/patients/999`

### Method 2: Direct Database Insert

Contact the Hospital project maintainer and provide this SQL query:

#### For PostgreSQL:
```sql
-- Insert CTF patient record
INSERT INTO patients (id, name, age, diagnosis, notes, created_at, updated_at)
VALUES (
    999,
    'CTF Test Patient',
    45,
    'Routine Checkup',
    'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
    NOW(),
    NOW()
)
ON CONFLICT (id) DO UPDATE
SET
    name = 'CTF Test Patient',
    notes = 'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
    updated_at = NOW();
```

#### For MySQL:
```sql
-- Insert CTF patient record
INSERT INTO patients (id, name, age, diagnosis, notes, created_at, updated_at)
VALUES (
    999,
    'CTF Test Patient',
    45,
    'Routine Checkup',
    'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
    NOW(),
    NOW()
)
ON DUPLICATE KEY UPDATE
    name = 'CTF Test Patient',
    notes = 'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
    updated_at = NOW();
```

#### For SQLite:
```sql
-- Insert CTF patient record
INSERT OR REPLACE INTO patients (id, name, age, diagnosis, notes, created_at, updated_at)
VALUES (
    999,
    'CTF Test Patient',
    45,
    'Routine Checkup',
    'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
    datetime('now'),
    datetime('now')
);
```

**Note:** Replace `CYBERLABFLAG{f6c7e8a9b1d2c3e4}` with your actual generated flag!

### Method 3: Database Seed File (For PR)

If submitting a PR, create a database seed file:

**File:** `db/seeds/ctf_data.sql` or `database/seeders/CTFSeeder.php`

```sql
-- CTF Test Data
-- Can be removed after CTF event

INSERT INTO patients (id, name, age, diagnosis, notes, created_at, updated_at)
VALUES (999, 'CTF Test Patient', 45, 'Routine Checkup',
        'Medical History: Patient reports normal health. CTF Flag: CYBERLABFLAG{f6c7e8a9b1d2c3e4}',
        NOW(), NOW());
```

### Verification

Test that the flag is accessible:

```bash
# If there's an API endpoint:
curl https://hospital.cyberlab.local/api/patients/999

# Or visit in browser:
https://hospital.cyberlab.local/patients/999
```

You should see the patient record with the flag in the notes field.

---

## Challenge 2: Doctor's Dashboard Discovery

**Challenge ID:** `hospital_admin_dashboard`
**Points:** 250
**Flag Location:** Hidden admin route

### Flag Format
```
CYBERLABFLAG{a1b2c3d4e5f6g7h8}
```
(Your actual flag will be different - use the one generated by test-local.sh)

### Method 1: Add Hidden Route (Requires Code Change)

This challenge requires adding a new route to the Hospital application. You'll need to submit a PR or request the Hospital team add it.

#### Example for Flask (Python):
```python
# Add to routes.py or app.py

@app.route('/ctf_admin_panel_secret_2024')
def ctf_admin_panel():
    return '''
    <!DOCTYPE html>
    <html>
    <head>
        <title>Admin Panel</title>
    </head>
    <body>
        <h1>Hospital Admin Panel</h1>
        <p>Welcome to the administrative dashboard.</p>
        <!-- CTF Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
    </body>
    </html>
    '''
```

#### Example for Express (Node.js):
```javascript
// Add to routes.js or app.js

app.get('/ctf_admin_panel_secret_2024', (req, res) => {
    res.send(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Admin Panel</title>
        </head>
        <body>
            <h1>Hospital Admin Panel</h1>
            <p>Welcome to the administrative dashboard.</p>
            <!-- CTF Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
        </body>
        </html>
    `);
});
```

#### Example for Laravel (PHP):
```php
// Add to routes/web.php

Route::get('/ctf_admin_panel_secret_2024', function () {
    return view('ctf_admin', [
        'flag' => 'CYBERLABFLAG{a1b2c3d4e5f6g7h8}'
    ]);
});
```

### Method 2: Add to Existing Page (Easier Alternative)

If adding a new route is too complex, add the flag as an HTML comment to an existing public page:

1. Find a public page file (e.g., `about.html`, `contact.html`, `index.html`)
2. Add this HTML comment anywhere in the file:

```html
<!-- CTF Admin Panel: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
```

3. Participants can find it by:
   - Viewing page source of various pages
   - Using tools like `curl` or `grep`
   - Checking robots.txt for clues

### Method 3: Static HTML File

Create a simple static HTML file if the Hospital project serves static files:

**File:** `public/ctf_admin_panel_secret_2024.html`

```html
<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
</head>
<body>
    <h1>Hospital Admin Panel</h1>
    <p>Welcome to the administrative dashboard.</p>
    <div style="display: none;">
        Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8}
    </div>
    <!-- CTF Flag: CYBERLABFLAG{a1b2c3d4e5f6g7h8} -->
</body>
</html>
```

### Verification

Test that the flag is accessible:

```bash
# Test the hidden route:
curl https://hospital.cyberlab.local/ctf_admin_panel_secret_2024

# Should return HTML with flag in comment
```

---

## Summary Checklist

Use this checklist to track flag planting progress:

- [ ] Generate flags using `./hospital/test-local.sh`
- [ ] Save generated flag values
- [ ] **Challenge 1:** Plant patient record flag
  - [ ] Method chosen: (Web UI / Database / PR)
  - [ ] Flag planted successfully
  - [ ] Verified accessible at `/patients/999` or `/api/patients/999`
- [ ] **Challenge 2:** Plant admin dashboard flag
  - [ ] Method chosen: (New route / HTML comment / Static file)
  - [ ] Flag planted successfully
  - [ ] Verified accessible
- [ ] Register challenges in CTFd: `./hospital/register-challenges.sh`
- [ ] Test challenges with dummy user account
- [ ] Document any special access requirements for participants

---

## Communication Template

Use this template when requesting flag planting from Hospital project maintainers:

```
Subject: CTF Flag Planting Request - Hospital System

Hi Hospital Team,

We're setting up a CTF platform for CyberLab and need to plant 2 flags
in the Hospital system. These are test data records that won't affect
production functionality.

WHAT WE NEED:

1. Patient Record (Challenge 1):
   - Add patient ID 999 with flag in notes field
   - SQL query provided below (copy-paste ready)
   - Should be accessible via IDOR at /patients/999

2. Hidden Admin Route (Challenge 2):
   - Add route: /ctf_admin_panel_secret_2024
   - Returns HTML with flag in comment
   - Code snippet provided below

TIMELINE: Need this within 5 days if possible.

DETAILS:
[Paste SQL query and code snippet from above]

Can you help with this? Let me know if you need any clarification!

Thanks,
CyberLab CTF Team
```

---

## Troubleshooting

### Flag not accessible after planting

1. **Check database:** Verify record exists with correct ID
2. **Check permissions:** Ensure endpoint doesn't require authentication
3. **Check routing:** Verify route is registered and app restarted
4. **Check firewall:** Ensure no firewall blocking access

### Don't have database access

- Work with Hospital team to run SQL queries
- Or use web interface if available
- Or submit PR with database seed file

### Can't add new routes

- Use HTML comment method instead
- Add flag to existing public page
- Create static HTML file if possible

---

## Next Steps

After planting flags:

1. Run verification tests: `cd .. && ./scripts/verify-challenges.sh`
2. Register in CTFd: `./hospital/register-challenges.sh`
3. Test manually with browser/curl
4. Document any special instructions for participants

For PR-based planting, see: [flag-planting-pr-template.md](flag-planting-pr-template.md)
